## 一、Mysql的 AKF 立方体

用 AKF 理解下 mysql为了确保数据库的高可用性在处理海量数据的时是如何实现的

![image-20241123234031462](/Users/gaoqisen/Library/Application Support/typora-user-images/image-20241123234031462.png)

X 轴：为了解决单点故障，mysql 可以用 **主从复制** 等方式进行副本扩展，这样在其中一台机器出现故障时。其他的机器也能正常提供服务

Y 轴：可以理解为数据的垂直拆分，比如当数据量太大的时候，单表的数据列太多，可以将表拆分为多张表。也可以将数据进行 **分库** 比如用户库、订单库等，这样可以避免单点故障用户库出现问题后订单库还是能提供服务的。

Z轴: 可以理解为数据的水平拆分，比如用户库里面的用户数据太多，单表查询很慢可以进行用户 ID 的取模 **分表** 操作，这种分表操作就是分区的效果（100 w的数据模 10，就是将数据分为 10 份每份 10w 的数据分区）。

上面每个轴的具体实现方式各有不同，关键点就是副本的扩展和分库分表。副本的扩展要考虑副本之间的数据如何同步，扩展的时候出现单点故障如何恢复等问题，下面先了解下副本扩展的各种架构演进

### 1.2 副本扩展

| 架构方式                                                     | 年份       | 版本    | 解决问题                                           |
| :----------------------------------------------------------- | ---------- | ------- | -------------------------------------------------- |
| 主从复制架构（Master - Slave Replication）                   | 1999       | 3.2.3   | 防止数据丢失、读写分离                             |
| 双主复制架构（Dual - Master Replication）                    | -          | -       | 双向数据同步，异地容灾                             |
| 主主复制管理 MMM（Master-Master replication manager for MySQL） | 2007～2008 | 4.x~5.x | 简化主主复制故障切换、提高可用性                   |
| 集群高可用 MHA（MySQL Master High Availability）             | 2010～2011 | 5.0+    | 减少切换主从速度、自动修复复制关系                 |
| 半同步                                                       |            |         |                                                    |
| ProxySql + 主从复制                                          |            |         |                                                    |
| 分片 + 高可用                                                |            |         |                                                    |
| Mysql组复制 MGR（MySQL Group Replication）                   | 2016       | 8.0+    | 官方实现Paxos 保证数据一致性、高可用和自动故障处理 |
| InnoDB Cluster                                               |            |         |                                                    |

各种架构的优确定分析

| 架构方式        | 优点 | 缺点 | 原理 |
| :-------------- | ---- | ---- | ---- |
| 主从复制架构MSR |      |      |      |
| 双主复制架构DMR |      |      |      |
| 主主复制管理MMM |      |      |      |
| 集群高可用MHA   |      |      |      |
| Mysql组复制MGR  |      |      |      |
| InnoDB Cluster  |      |      |      |

### 1.2 分库分表



## 二、Mysql 语句执行过程



### 2.1 查询语句



### 2.2 增删改语句



## 三、事务

MVCC



Buffer Pool、自适应Hash索引、双写缓冲区。

## 四、查询语句优化

索引

索引失效

执行计划

成本计算

